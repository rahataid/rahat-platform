meta {
  name: password-login
  type: http
  seq: 2
}

post {
  url: {{url}}/vendors/password-login
  body: json
  auth: none
}

body:json {
  {
    "identifier": "john2_vendor_e842d8",
    "password": "h67HwZ9ZTs^Dw&",
    "service": "USERNAME"
  }
}

assert {
  res.status: eq 200
  res.body.success: eq true
  res.body.data: isJson
}

script:post-response {
  const responseData = res.getBody();
  if (responseData.data?.accessToken) {
    bru.setVar("access_token", responseData.data.accessToken);
    
    console.log('=== Vendor Login Successful ===');
    console.log('\nUser Info:');
    console.log('  ID:', responseData.data.user?.id);
    console.log('  UUID:', responseData.data.user?.uuid);
    console.log('  Name:', responseData.data.user?.name);
    console.log('  Wallet:', responseData.data.user?.wallet);
    
    if (responseData.data?.wallet) {
      console.log('\nWallet Details:');
      console.log('  Address:', responseData.data.wallet?.address);
      console.log('  Private Key:', responseData.data.wallet?.privateKey);
    }
    
    console.log('\nAccess Token saved to environment variable: access_token');
  }
}

tests {
  test('should login vendor successfully', async () => {
    const responseData = res.getBody().data;
    expect(responseData).to.have.property('accessToken');
    expect(responseData).to.have.property('user');
    expect(responseData.user).to.have.property('id');
    expect(responseData.user).to.have.property('wallet');
  });
  
  test('should return wallet information', async () => {
    const responseData = res.getBody().data;
    expect(responseData).to.have.property('wallet');
    expect(responseData.wallet).to.have.property('address');
  });
}

docs {
  # Vendor Password Login
  
  This endpoint allows vendors to login using their username and password credentials.
  
  ## Request Body:
  - **identifier**: Username, email, or phone number
  - **password**: Vendor's password
  - **service**: Authentication service type (USERNAME, EMAIL, or PHONE)
  
  ## Response Includes:
  - **accessToken**: JWT token for authenticated requests
  - **user**: Full vendor user information (id, uuid, name, wallet, etc.)
  - **wallet**: Vendor's wallet details including:
    - address: Blockchain wallet address
    - privateKey: Private key for transactions
  
  ## Usage:
  1. Use credentials from vendor registration (/v1/vendors/password-register)
  2. Login with username and password
  3. Access token is automatically saved for subsequent requests
  4. Wallet details are returned for vendor operations
  
  ## Example:
  ```json
  {
    "identifier": "john_vendor_a3f5c2",
    "password": "AutoGeneratedPass123!",
    "service": "USERNAME"
  }
  ```
}
