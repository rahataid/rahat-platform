meta {
  name: password-register
  type: http
  seq: 1
}

post {
  url: {{url}}/vendors/password-register
  body: json
  auth: bearer
}

auth:bearer {
  token: {{access_token}}
}

body:json {
  {
    "name": "John Vendor",
    "service": "USERNAME",
    "email": "vendor143@example.com",
    "phone": "+123435678940",
    "extras": {
      "isVendor": true
    }
  }
}

assert {
  res.status: eq 201
  res.body.success: eq true
  res.body.data: isJson
}

script:post-response {
  const responseData = res.getBody();
  if (responseData.data?.credentials) {
    console.log('=== Vendor Registration Successful ===');
    console.log('\nCredentials:');
    console.log('  Username:', responseData.data.credentials.username);
    console.log('  Temp Password:', responseData.data.credentials.tempPassword);
    
    if (responseData.data?.wallet) {
      console.log('\nWallet Details:');
      console.log('  Address:', responseData.data.wallet.address);
      console.log('  Blockchain:', responseData.data.wallet.blockchain);
      console.log('  Private Key:', responseData.data.wallet.privateKey);
    }
    
    console.log('\n' + responseData.data.message);
    console.log(responseData.data.note);
  }
}

tests {
  test('should register vendor with auto-generated password', async () => {
    const responseData = res.getBody().data;
    expect(responseData).to.have.property('credentials');
    expect(responseData.credentials).to.have.property('username');
    expect(responseData.credentials).to.have.property('tempPassword');
    expect(responseData).to.have.property('message');
  });
  
  test('should include signup data', async () => {
    const responseData = res.getBody().data;
    expect(responseData).to.have.property('signup');
    expect(responseData.signup).to.have.property('status');
  });
  
  test('should include auto-generated wallet details', async () => {
    const responseData = res.getBody().data;
    expect(responseData).to.have.property('wallet');
    expect(responseData.wallet).to.have.property('address');
    expect(responseData.wallet).to.have.property('blockchain');
    expect(responseData.wallet).to.have.property('privateKey');
  });
}

docs {
  # Vendor Password Registration
  
  This endpoint registers a new vendor with auto-generated username, password, and wallet.
  
  ## Auto-Generated:
  - **Username**: Generated from vendor name (e.g., "john_vendor_1234")
  - **Password**: Secure random password (12 characters)
  - **Wallet**: EVM/Stellar wallet address with private key
  
  ## Process:
  1. Admin calls this endpoint with vendor details (name, email, phone)
  2. System generates:
     - Username from name
     - Secure password
     - Blockchain wallet (address + private key)
  3. Vendor is registered with VENDOR role
  4. All credentials and wallet details are returned to admin
  5. Admin shares credentials and wallet securely with vendor
  
  ## Response Includes:
  - Login credentials (username, password)
  - Wallet details (address, blockchain, private key)
  - Instructions for vendor login
  
  ## Vendor Login:
  Vendor can login using the credentials at `/v1/auth/login/password` endpoint
  
  ## Note:
  The wallet property in the request body is now optional - system will auto-generate if not provided.
}
