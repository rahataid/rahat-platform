meta {
  name: password-register
  type: http
  seq: 1
}

post {
  url: {{url}}/vendors/password-register
  body: json
  auth: bearer
}

auth:bearer {
  token: {{access_token}}
}

body:json {
  {
    "name": "John2 Vendor",
    "username": "john2_vendor_test",
    "password": "SecurePass123!",
    "service": "USERNAME",
    "email": "vendscor2df43@example.com",
    "phone": "+122322252678940",
    "extras": {
      "isVendor": true
    }
  }
}

assert {
  res.status: eq 201
  res.body.success: eq true
  res.body.data: isJson
}

script:post-response {
  const responseData = res.getBody();
  if (responseData.data?.accessToken) {
    bru.setVar("access_token", responseData.data.accessToken);
    console.log('=== Vendor Registration Successful ===');
    console.log('\nAccess Token saved to environment variable: access_token');
  }
  
  if (responseData.data?.user) {
    console.log('\nUser Info:');
    console.log('  ID:', responseData.data.user.id);
    console.log('  UUID:', responseData.data.user.uuid);
    console.log('  Name:', responseData.data.user.name);
    console.log('  Wallet:', responseData.data.user.wallet);
  }
  
  if (responseData.data?.wallet) {
    console.log('\nWallet Details:');
    console.log('  Address:', responseData.data.wallet.address);
    console.log('  Blockchain:', responseData.data.wallet.blockchain);
    console.log('  Private Key:', responseData.data.wallet.privateKey);
  }
  
  if (responseData.data?.message) {
    console.log('\n' + responseData.data.message);
  }
}

tests {
  test('should return accessToken', async () => {
    const responseData = res.getBody().data;
    expect(responseData).to.have.property('accessToken');
  });
  
  test('should include signup data', async () => {
    const responseData = res.getBody().data;
    expect(responseData).to.have.property('signup');
    expect(responseData.signup).to.have.property('status');
  });
  
  test('should include user information', async () => {
    const responseData = res.getBody().data;
    expect(responseData).to.have.property('user');
    expect(responseData.user).to.have.property('id');
    expect(responseData.user).to.have.property('uuid');
    expect(responseData.user).to.have.property('name');
    expect(responseData.user).to.have.property('wallet');
  });
  
  test('should include auto-generated wallet details', async () => {
    const responseData = res.getBody().data;
    expect(responseData).to.have.property('wallet');
    expect(responseData.wallet).to.have.property('address');
    expect(responseData.wallet).to.have.property('blockchain');
    expect(responseData.wallet).to.have.property('privateKey');
  });
}

docs {
  # Vendor Password Registration
  
  This endpoint registers a new vendor with username, password, and auto-generated wallet.
  
  ## Required Fields:
  - **name**: Vendor name
  - **username**: Unique username for the vendor
  - **password**: Password for authentication
  - **service**: Authentication service (typically "USERNAME")
  - **email**: Vendor email (optional)
  - **phone**: Vendor phone number (optional)
  
  ## Auto-Generated:
  - **Wallet**: EVM/Stellar wallet address with private key
  
  ## Process:
  1. Admin calls this endpoint with vendor details (name, username, password, email, phone)
  2. System generates:
     - Blockchain wallet (address + private key)
  3. Vendor is registered with VENDOR role
  4. Access token is automatically generated and returned
  5. All credentials and wallet details are returned to admin
  
  ## Response Includes:
  - **accessToken**: JWT token for immediate authentication
  - **signup**: Signup record details
  - **user**: User information (id, uuid, name, wallet)
  - **wallet**: Wallet details (address, blockchain, private key, mnemonic)
  
  ## Vendor Login:
  Vendor can login using the credentials at `/vendors/password-login` endpoint, or use the returned accessToken immediately.
  
  ## Note:
  The wallet property in the request body is optional - system will auto-generate if not provided.
}
